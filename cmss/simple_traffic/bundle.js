import{toWindow as I}from"https://code.agentscript.org/src/utils.js";import y from"https://code.agentscript.org/src/TwoDraw.js";import x from"https://code.agentscript.org/src/Animator.js";import l from"https://code.agentscript.org/src/Color.js";import w from"https://code.agentscript.org/src/Model.js";import"https://code.agentscript.org/src/Patch.js";var v=20,S=.026,_=.0045,m=-25,c=class extends w{constructor(){super({maxX:25,minX:m,minY:-4,maxY:4});this.averageSpeed=0,this.maxSpeed=0,this.redCarSpeed=0,this.numberOfCars=v,this.speed_limit=1,this.speed_min=0,this.deceleration=S,this.acceleration=_}setup(){this.turtles.create(this.numberOfCars),this.patches.setDefault("color","black");let e=0;this.turtles.ask(t=>{t.id=e++,this.turtles.color="blue";let[s,a]=this.world.randomPoint();t.setxy(s,0),t.speed=.1+Math.random()*.9,t.heading=90}),this.turtles.ask(t=>{for(;t.patch.turtlesHere.length>1;)console.log("moved forward!"),t.forward(1)}),this.turtles.first().color="red",this.patches.ask(t=>{this.setup_road(t)})}step(){this.turtles.ask(s=>{let a=s.patchAhead(1);a===void 0&&(a=this.patches.patch(m,0));let o=a.turtlesHere;o.length==0?this.speedUp(s):this.slowDown(s,o.first()),s.speed<this.speed_min|isNaN(s.speed)|this.speed_min>this.speed_limit&&(s.speed=this.speed_min),s.speed>this.speed_limit&&(s.speed=this.speed_limit),s.forward(s.speed)}),this.patches.ask(s=>{});let e=0,t=0;for(let s of this.turtles)e+=s.speed,s.speed>t&&(t=s.speed);this.averageSpeed=e/this.turtles.length,this.maxSpeed=t,this.redCarSpeed=this.turtles[0].speed}slowDown(e,t){e.speed=t.speed-this.deceleration}speedUp(e){e.speed=e.speed+this.acceleration}setup_road(e){e.y<2&e.y>-2?e.color="white":e.color="black"}},f=c;import{Chart as C,registerables as E}from"https://cdn.jsdelivr.net/npm/chart.js/dist/chart.mjs";C.register(...E);var k=800,A=function(r){r.arc(0,0,.5,0,2*Math.PI)},j=l.typedColor("red"),P=l.typedColor("blue"),D=l.typedColor("white"),M=l.typedColor("black"),N={turtlesShape:"car",turtlesColor:r=>{switch(r.color){case"red":return j;default:return P}},turtlesSize:1,patchesColor:r=>{switch(r.color){case"white":return D;default:return M}}},p=class{constructor(e){this.modelContainer=document.createElement("div"),this.modelContainer.id="current-model-div",this.chartContainer=document.createElement("div"),this.chartContainer.id="current-chart-div",this.chartCanvas=document.createElement("canvas"),this.chartCanvas.id="current-linechart",this.chartContainer.appendChild(this.chartCanvas),e.appendChild(this.modelContainer),e.appendChild(this.chartContainer),this.containerDiv=e,this.model=new f,this.slidecontainer=document.createElement("div"),this.buildSliders(),this.onoff=document.createElement("input"),this.onoff.type="button",this.onoff.value="Start";let t=this.onoff,s=this;this.onoff.onclick=function(){if(t.value=="Start"){t.value="Running",s.start();return}t.value=="Paused"?t.value="Running":t.value="Paused"},this.slidecontainer.appendChild(document.createElement("br")),this.slidecontainer.style.width=800,this.slidecontainer.appendChild(this.onoff)}buildSliders(){this.addSlider("numberOfCars",1,41,20,"Number of Cars"),this.addSlider("speed_limit",0,2,1,"Speed limit",.01),this.containerDiv.prepend(this.slidecontainer)}addSlider(e,t,s,a,o,h=1){let i=document.createElement("input");i.id=this.containerDiv.id+"_slider_",i.type="range",i.min=t,i.max=s,i.step=h,i.value=a,i.style.width="100%",this.model[e]=Number(i.value);let u=document.createElement("h4");u.textContent=o+": ";let n=document.createElement("label");n.textContent=i.value,n.for=i.id;let b=this;i.oninput=function(){n.textContent=i.value,b.model[e]=Number(i.value)};let d=document.createElement("div");d.appendChild(u),d.appendChild(document.createElement("br")),d.appendChild(i),d.appendChild(n),this.slidecontainer.appendChild(d)}async start(){document.getElementById(this.containerDiv.id+"_slider_").disabled=!0;let e=this.model;await e.startup(),e.setup();let t=Math.floor(k/e.world.width),s=new y(e,{div:this.modelContainer.id,patchSize:t},N);s.turtlesView.shapes.addPath("car",A);let a=t*e.world.width;this.chartContainer.style.width=a;let o=new C(this.chartCanvas,{type:"line",data:{labels:[],datasets:[{label:"Average Speed",borderColor:"#000000",backgroundColor:"#0000FF",data:[],borderWidth:1},{label:"Max Speed",borderColor:"#000000",backgroundColor:"#7CFC00",data:[],borderWidth:1},{label:"Red Car Speed",borderColor:"#000000",backgroundColor:"#ff0000",data:[],borderWidth:1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0},x:{ticks:{display:!1},grid:{display:!1}}},animation:{duration:0},plugins:{legend:{position:"top",display:!1},colors:{enabled:!0},tooltip:{animation:!1},title:{display:!0,text:"Speed Chart"}}}}),h=new x(()=>{if(this.onoff.value=="Paused")return;e.step(),s.draw();let i=o.data;i.labels.push(e.ticks),i.datasets[0].data.push(e.averageSpeed),i.datasets[1].data.push(e.maxSpeed),i.datasets[2].data.push(e.redCarSpeed),i.datasets[0].data.length>500&&(i.datasets[0].data.shift(),i.datasets[1].data.shift(),i.datasets[2].data.shift(),i.labels.shift()),o.update("none")},-1,30);I({model:e,view:s,anim:h})}},g=p;var V=new g(document.getElementById("other-div"));
